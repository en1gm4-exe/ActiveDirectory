![image](https://github.com/user-attachments/assets/755f9983-7390-4264-837a-b75898a4cbc5)![image](https://github.com/user-attachments/assets/d9509ed9-4fa9-4285-bf27-51e33bdedb01)


# Exploiting Active Directory
  Learn common AD exploitation techniques that can allow you to reach your goal in an AD environment.

TryHackMe room [link](https://tryhackme.com/room/exploitingad)

<br>


## Task 1 : Introduction

  This task is part of an Active Directory (AD) exploitation lab, building on previous networks (Breaching AD and Enumerating AD). The goal is to exploit AD misconfigurations for lateral movement and privilege escalation.

> Workflow...

- Network Setup:
    
    - The network includes hosts like THYCHILDC (10.200.47.101) and THYSERVER1 (10.200.47.201).
    - DNS must be configured to resolve .loc domains (e.g., thmdc.za.tryhackme.loc).
    - AttackBox users automatically connect but must set DNS manually.
    - Other hosts (OpenVPN/Kali) require manual DNS setup.
      - Configure DNS.
 
            sed -i '1s|^|nameserver $THMDCIP\n|' /etc/resolv-dnsmasq
        
      - Test DNS.  

            nslookup thmdc.za.tryhackme.loc
        
- Initial Access:
    
    - Credentials are obtained from the follwoing web-page..

            http://distributor.za.tryhackme.loc/creds
      
    - These credentials allow `RDP`/`SSH` access to `THMWRK1.za.tryhackme.loc` (jump host).
      
- Exploitation Techniques Covered:

    - AD Delegation
    - Forcing Authentication Relays
    - Group Policy Objects (GPOs)
    - Targeting AD Users
    - Domain Trusts
    - Silver/Golden Tickets
      
- Post exploitation:
    
    - Perform lateral movement and privilege escalation.
    - Later tasks will cover persistence

 ![image](https://github.com/user-attachments/assets/956a81fb-affb-4677-92ed-07354be34f88)


<br>



## Task 2: Exploiting Permission Delegation

- This task demonstrates how Active Directory (AD) Permission Delegation can be exploited to escalate privileges. The key steps involve:
  - Identifying Misconfigured ACEs (Access Control Entries) that grant excessive permissions (e.g., `AddMembers`, `ForceChangePassword`).
  - Using `BloodHound` to analyze attack paths (e.g., from a low-privileged user to `Tier 2 Admins`).
  - Exploiting Weak Delegation by:
    - Adding our account to the IT Support group (using `Add-ADGroupMember`).
    - Forcing a password reset on a Tier 2 Admin (using `Set-ADAccountPassword`).
  - Gaining `Administrative` Access to `THMWRK1`.
 


> Workflow....

### 1: Access BloodHound
  -  Start Neo4j:

         neo4j console start
     
  - Open BloodHound in another terminal:

        bloodhound --no-sandbox
    
  - Log in with default credentials: `neo4j`:`neo4j`.

  ![image](https://github.com/user-attachments/assets/f92bb430-b208-4e7b-882f-238287971a7d)

  - Import the provided `SharpHound` data (ZIP file) by dragging it into BloodHound.

### 2: Identify Attack Path
  
  - Search for your assigned `AD` user (from Task 1).
  - Set `start` position: Your user.
  - Set `end` position: Tier 2 Admins group.
  - BloodHound reveals:
    - Domain Users can add members to IT Support (AddMembers ACE).
    - IT Support can reset passwords for Tier 2 Admins (ForceChangePassword ACE).

### 3: Exploit Misconfigured ACEs
 - Add Your Account to IT Support (via PowerShell on THMWRK1):

        Add-ADGroupMember "IT Support" -Members "Your.AD.Username"
   
    - Verify with:
  
          Get-ADGroupMember -Identity "IT Support"
  - Force Password Reset for a Tier 2 Admin:
    - List Tier 2 Admins:
  
          Get-ADGroupMember -Identity "Tier 2 Admins"
      
    - Reset password (replace `Target.Admin` with a chosen account):
  
          $Password = ConvertTo-SecureString "Hack123!" -AsPlainText -Force
          Set-ADAccountPassword -Identity "t2_leon.francis" -Reset -NewPassword $Password
      
     - Wait 5-10 mins for propagation (or run `gpupdate /force`).

### 4: Retrieve the Flag

- RDP/SSH into `THMWRK1` using the compromised Tier 2 Admin credentials.
- Navigate to the Administratorâ€™s Desktop and open `flag1.txt`.


  
